jQuery.fn.colorPicker=function(conf){var config=jQuery.extend({id:'jquery-color-picker',ico:'ico.gif',title:'Pick a color',inputBG:true,speed:500,openTxt:'Open color picker'},conf);var hexInvert=function(hex){var r=hex.substr(0,2);var g=hex.substr(2,2);var b=hex.substr(4,2);return 0.212671*r+0.715160*g+0.072169*b<0.5?'ffffff':'000000'};var colorPicker=jQuery('#'+config.id);if(!colorPicker.length){colorPicker=jQuery('<div id="'+config.id+'"></div>').appendTo(document.body).hide();jQuery(document.body).click(function(event){if(!(jQuery(event.target).is('#'+config.id)||jQuery(event.target).parents('#'+config.id).length)){colorPicker.hide(config.speed)}})}return this.each(function(){var select=jQuery(this);var icon=jQuery('<a href="#"><div id="jquery-color-picker-icon" /></a>').insertAfter(select);var input=jQuery('<input type="text" id="'+select.attr('name')+'" name="'+select.attr('name')+'" value="'+select.val()+'" size="6" />').insertAfter(select);var loc='';jQuery('option',select).each(function(){var option=jQuery(this);var hex=option.val().substr(1);loc+='<li><a href="#" rel="'+hex+'" style="background: #'+hex+'; color: '+hexInvert(hex)+';">&nbsp;</a></li>'});select.remove();if(config.inputBG){input.change(function(){input.css({background:'#'+input.val(),color:'#'+hexInvert(input.val())})});input.change()}icon.click(function(){var iconPos=icon.offset();colorPicker.html('<ul>'+loc+'</ul>').css({position:'absolute',left:iconPos.left+'px',top:iconPos.top+'px'}).show(config.speed);jQuery('a',colorPicker).click(function(){var hex=jQuery(this).attr('rel');input.val('#'+hex);if(config.inputBG){input.css({background:'#'+hex,color:'#'+hexInvert(hex)})}input.change();colorPicker.hide(config.speed);return false});return false})})};